{% extends 'header-and-footer.html' %}

{% block main_content %}

<main class="main-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 d-flex align-items-stretch">
                <section class="page-block">
                    <h3>
                        Самые популярные запросы
                    </h3>
                    <table class="table table-dark table-hover table-striped table-sm">
                        <thead class="thead-light">
                            <tr>
                                <th>#</th>
                                <th>Запрос</th>
                                <th>Количество</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for line in the_popular_requests %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ line[0] }}</td>
                                <td>{{ line[1] }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>

            <div class="col-lg-6 d-flex align-items-stretch">
                <section class="page-block">
                    <h3>
                        Самые активные пользователи
                    </h3>
                    <table class="table table-dark table-hover table-striped table-sm">
                        <thead class="thead-light">
                            <tr>
                                <th>#</th>
                                <th>Имя</th>
                                <th>Количество</th>
                            </tr>
                        </thead>
                                            <tbody>
                        {% for line in the_active_users %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ line[0] }}</td>
                                <td>{{ line[1] }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </section>
            </div>
        </div>
    </div>

    <div class="container">
      <section class="log">
        <h3>
            Количество записей: {{ the_req_count }}
        </h3>
            <table class="table table-hover table-striped table-sm">
                <thead class="thead-dark">
                    <tr>
                        <th>#</th>
                        <th>Дата</th>
                        <th>Время</th>
                        <th>Пользователь</th>
                        <th>Команда</th>
                    </tr>
                </thead>
                <tbody>
                {% set begin = the_req_count - (the_req_count//the_row_on_page - the_page)*the_row_on_page %}
                {% for line in the_data %}
                    <tr>
                        <td>{{ begin - loop.index + 1 }}</td>
                        <td>{{ line['date'] }}</td>
                        <td>{{ line['time'] }}</td>
                        <td>{{ line['name'] }}</td>
                        <td>{{ line['body'] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </section>
    </div>

    <div class="container">
        <nav class="pag">
            <h3>Страница {{ the_page }} из {{ the_req_count // the_row_on_page }}</h3>
            <ul class="pagination justify-content-center">
            {% if the_page == the_req_count // the_row_on_page %}
                {% set first="disabled" %}
            {% else %}
                {% set first="" %}
            {% endif %}
                <li class="page-item {{ first }}">
                <a class="page-link" href="?page={{ the_req_count // the_row_on_page }}">
                        Последняя
                    </a>
                </li>
                <li class="page-item {{ first }}">
                    <a class="page-link"
                       aria-label="Previous"
                       href="?page={{ the_page+1 }}">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>

            {% if the_page > the_req_count // the_row_on_page - 5 %}
                {% set begin=the_req_count // the_row_on_page %}
            {% elif the_page < 6 %}
                {% set begin=the_req_count // the_row_on_page - 5 %}
            {% else %}
                {% set begin=the_page+5 %}
            {% endif %}
            {% for page_num in range(begin, begin-10, -1) %}
                {% if page_num == the_page %}
                <li class="page-item active">
                {% else %}
                <li class="page-item">
                {% endif %}
                    <a class="page-link" href="?page={{ page_num }}">
                        {{ page_num }}
                    </a>
                </li>
            {% endfor %}

            {% if the_page == 1 %}
                {% set last = "disabled" %}
            {% else %}
                {% set last = "" %}
            {% endif %}
                <li class="page-item {{ last }}">
                    <a class="page-link"
                       aria-label="Next"
                       href="?page={{ the_page-1 }}">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
                <li class="page-item {{ last }}">
                    <a class="page-link" href="?page=1">
                        Первая
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</main>
{% endblock %}